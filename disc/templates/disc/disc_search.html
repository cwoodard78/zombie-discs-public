{% extends "base.html" %}

{% block title %}Search Discs{% endblock %}

{% block content %}
    <div class="max-w-6xl mx-auto bg-white rounded-lg shadow-md p-6">
        <h1 class="text-2xl font-semibold text-gray-800 mb-4">Search Discs</h1>
        
        <form method="get" action="" class="space-y-4">
            <!-- Main Search Box -->
            <div class="flex justify-center mb-4">
                <input type="text" name="query" placeholder="Search discs..." 
                    class="w-full max-w-lg border border-gray-300 rounded px-4 py-2"
                    value="{{ request.GET.query }}">
            </div>

            <!-- Filters Section -->
            <div class="flex flex-wrap gap-4 items-center justify-center">
                <!-- Type Dropdown -->
                <div>
                    <label for="type" class="block text-sm font-medium text-gray-700">Type:</label>
                    <select name="type" id="type" class="border border-gray-300 rounded px-4 py-2">
                        <option value="">----------</option>
                        {% for choice in filter.form.type.field.choices %}
                            <option value="{{ choice.0 }}" {% if choice.0 == request.GET.type %}selected{% endif %}>
                                {{ choice.1 }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Mold Name -->
                <div>
                    <label for="mold_name" class="block text-sm font-medium text-gray-700">Mold Name:</label>
                    <input type="text" name="mold_name" id="mold_name" 
                        class="border border-gray-300 rounded px-4 py-2"
                        value="{{ request.GET.mold_name }}">
                </div>

                <!-- Manufacturer Dropdown -->
                <div>
                    <label for="manufacturer" class="block text-sm font-medium text-gray-700">Manufacturer:</label>
                    <select name="manufacturer" id="manufacturer" class="border border-gray-300 rounded px-4 py-2">
                        <option value="">----------</option>
                        {% for manufacturer in filter.form.manufacturer.field.queryset %}
                            <option value="{{ manufacturer.id }}" {% if manufacturer.id|stringformat:"s" == request.GET.manufacturer %}selected{% endif %}>
                                {{ manufacturer }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Color -->
                <div>
                    <label for="color" class="block text-sm font-medium text-gray-700">Color:</label>
                    <input type="text" name="color" id="color" 
                        class="border border-gray-300 rounded px-4 py-2"
                        value="{{ request.GET.color }}">
                </div>

                <!-- Status Dropdown -->
                <div>
                    <label for="status" class="block text-sm font-medium text-gray-700">Status:</label>
                    <select name="status" id="status" class="border border-gray-300 rounded px-4 py-2">
                        <option value="">----------</option>
                        {% for choice in filter.form.status.field.choices %}
                            <option value="{{ choice.0 }}" {% if choice.0 == request.GET.status %}selected{% endif %}>
                                {{ choice.1 }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Notes -->
                <div>
                    <label for="notes" class="block text-sm font-medium text-gray-700">Notes:</label>
                    <input type="text" name="notes" id="notes" 
                        class="border border-gray-300 rounded px-4 py-2"
                        value="{{ request.GET.notes }}">
                </div>
            </div>

            <!-- Submit Button -->
            <div class="flex justify-center mt-6">
                <button type="submit" class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600">
                    Search
                </button>
            </div>
        </form>
    </div>

    <div class="mt-6">
        {% if filter.qs %}
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Results</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white rounded-lg shadow-md">
                    <thead>
                        <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                            <th class="py-3 px-6 text-left">Color</th>
                            <th class="py-3 px-6 text-left">Type</th>
                            <th class="py-3 px-6 text-left">Status</th>
                            <th class="py-3 px-6 text-left">Manufacturer</th>
                            <th class="py-3 px-6 text-left">Mold</th>
                            <th class="py-3 px-6 text-left">Details</th>
                        </tr>
                    </thead>
                    <tbody class="text-gray-700 text-sm">
                        {% for disc in filter.qs %}
                            <tr class="border-b border-gray-200 hover:bg-gray-100">
                                <!-- Load background colors -->
                                {% load color_utils %}
                                <td class="py-3 px-6" style="background: {{ disc.color|validate_color }};">
                                    {{ disc.color }}
                                </td>
                                <td class="py-3 px-6">{{ disc.type }}</td>
                                <td class="py-3 px-6">{{ disc.status }}</td>
                                <td class="py-3 px-6">{{ disc.manufacturer }}</td>
                                <td class="py-3 px-6">{{ disc.mold_name }}</td>
                                <td class="py-3 px-6">
                                    <a href="{% url 'disc_detail' disc.id %}" class="text-blue-500 hover:underline">
                                        View Details
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p class="text-gray-600">No results found.</p>
        {% endif %}
    </div>
    
{% endblock %}
