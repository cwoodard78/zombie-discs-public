{% extends "base.html" %}

{% block title %}Zombie Discs{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto bg-white rounded-lg shadow-md p-6">
    <h1 class="text-3xl font-bold text-gray-800 mb-8">Welcome back, {{ user.username }} ðŸŒŸ</h1>

    <!-- Summary Section -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-10">
        <div class="bg-blue-100 text-blue-800 rounded p-4">
            <p class="text-sm font-semibold">Active Lost Discs</p>
            <p class="text-2xl font-bold">{{ lost_discs.paginator.count }}</p>
        </div>
        <div class="bg-green-100 text-green-800 rounded p-4">
            <p class="text-sm font-semibold">Active Found Discs</p>
            <p class="text-2xl font-bold">{{ found_discs.paginator.count }}</p>
        </div>
        <div class="bg-yellow-100 text-yellow-800 rounded p-4">
            <p class="text-sm font-semibold">Top Reward</p>
            <p class="text-2xl font-bold">
                {% if top_rewards %}${{ top_rewards.0.amount }}{% else %}N/A{% endif %}
            </p>
        </div>
    </div>

    <!-- Disc Tabs -->
    <div class="mb-10">
        <div class="flex border-b mb-2">
            <button id="tab-lost" class="tab-btn {% if active_tab == 'lost' %}active{% endif %}">Lost Discs</button>
            <button id="tab-found" class="tab-btn {% if active_tab == 'found' %}active{% endif %}">Found Discs</button>
        </div>

        <!-- Lost Discs Table -->
        <div id="lost-content" class="tab-content {% if active_tab != 'lost' %}hidden{% endif %}">
            {% include "disc_table.html" with discs=lost_discs label="Lost Date" page_param="lost_page" %}
        </div>

        <!-- Found Discs Table -->
        <div id="found-content" class="tab-content {% if active_tab != 'found' %}hidden{% endif %}">
            {% include "disc_table.html" with discs=found_discs label="Found Date" page_param="found_page" %}
        </div>
    </div>

    <!-- Top Rewards Section -->
    <div class="mt-12">
        <h2 class="text-xl font-semibold text-gray-700 mb-4">ðŸ“ˆ Top Disc Rewards</h2>
        {% comment %} {% include "partials/reward_table.html" with rewards=top_rewards %} {% endcomment %}
    </div>

    <!-- Leaderboard Section -->
    <div class="mt-12">
        <h2 class="text-xl font-semibold text-gray-700 mb-4">ðŸ¥‡ Leaderboard</h2>

        <div class="flex border-b mb-4">
            <button class="tab-btn-leaderboard active" data-tab="lost-leaderboard">Most Lost</button>
            <button class="tab-btn-leaderboard" data-tab="found-leaderboard">Most Found</button>
            <button class="tab-btn-leaderboard" data-tab="karma-leaderboard">Top Karma</button>
        </div>

        <div id="lost-leaderboard" class="leaderboard-tab">
            {% include "leaderboard_table.html" with leaderboard=lost_leaderboard stat="lost_count" label="Lost Discs" %}
        </div>
        <div id="found-leaderboard" class="leaderboard-tab hidden">
            {% include "leaderboard_table.html" with leaderboard=found_leaderboard stat="found_count" label="Found Discs" %}
        </div>
        <div id="karma-leaderboard" class="leaderboard-tab hidden">
            {% include "leaderboard_table.html" with leaderboard=karma_leaderboard stat="karma" label="Karma Score" %}
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const tabs = ["lost", "found"];
        tabs.forEach(tab => {
            const btn = document.getElementById(`tab-${tab}`);
            btn.addEventListener('click', () => {
                tabs.forEach(t => {
                    document.getElementById(`${t}-content`).classList.add("hidden");
                    document.getElementById(`tab-${t}`).classList.remove("active");
                });
                document.getElementById(`${tab}-content`).classList.remove("hidden");
                btn.classList.add("active");
            });
        });

        const leaderboardTabs = document.querySelectorAll(".tab-btn-leaderboard");
        const leaderboardContent = document.querySelectorAll(".leaderboard-tab");

        leaderboardTabs.forEach(btn => {
            btn.addEventListener("click", () => {
                leaderboardTabs.forEach(b => b.classList.remove("active"));
                leaderboardContent.forEach(tab => tab.classList.add("hidden"));

                btn.classList.add("active");
                document.getElementById(btn.dataset.tab).classList.remove("hidden");
            });
        });
    });
</script>

<style>
    .tab-btn {
        padding: 10px 20px;
        cursor: pointer;
        border: none;
        background: none;
        font-weight: bold;
    }
    .tab-btn.active {
        border-bottom: 2px solid #3b82f6;
        color: #3b82f6;
    }
    .tab-content.hidden, .leaderboard-tab.hidden {
        display: none;
    }
    .tab-btn-leaderboard {
        padding: 8px 16px;
        cursor: pointer;
        font-weight: bold;
        background: none;
        border: none;
    }
    .tab-btn-leaderboard.active {
        border-bottom: 2px solid #3b82f6;
        color: #3b82f6;
    }
</style>
{% endblock %}
